CREATE TABLE "User" (
    id BIGINT PRIMARY KEY,
    username VARCHAR(20) NOT NULL UNIQUE,
    nickname VARCHAR(20),
    avatar VARCHAR(255),
    email VARCHAR(30) UNIQUE,
    password VARCHAR(16) NOT NULL,
    type_id BIGINT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "User_Role" (
    id SMALLINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    role SMALLINT NOT NULL UNIQUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "User_Role_Mapping" (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES "User"(id),
    user_role_id SMALLINT NOT NULL REFERENCES "User_Role"(id),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "Web3_User" (
    id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES "User"(id),
    wallet_address VARCHAR(255) NOT NULL UNIQUE,
    chain_id SMALLINT NOT NULL,
    chain_type VARCHAR(10) NOT NULL DEFAULT 'mainnet',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "Author" (
    id INTEGER PRIMARY KEY,
    real_name VARCHAR(20) NOT NULL,
    is_enable BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "Author_User_Mapping" (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    author_id INTEGER NOT NULL REFERENCES "Author"(id),
    user_id BIGINT NOT NULL REFERENCES "User"(id),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_web3_user_wallet_address ON "Web3_User" (wallet_address);

CREATE TABLE "TokenMapping" (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    parent_token VARCHAR(512) NOT NULL,
    child_token VARCHAR(512) NOT NULL UNIQUE,
    user_id BIGINT NOT NULL REFERENCES "User" (id),
    permissions VARCHAR(255),
    expires_at TIMESTAMP NOT NULL,
    is_revoked BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_parent_token ON "TokenMapping" (parent_token);
CREATE INDEX idx_child_token ON "TokenMapping" (child_token);
CREATE INDEX idx_user_id ON "TokenMapping" (user_id);
CREATE INDEX idx_expires_at ON "TokenMapping" (expires_at);

CREATE TABLE user_profile (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES "User" (id),
    age INTEGER,
    external_debt_ratio FLOAT,
    gps_stability FLOAT,
    device_shared_degree INTEGER,
    device_risk_tag VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_user_profile_user_id ON user_profile (user_id);
